webpackJsonp([69],{h4LK:function(t,i){},sRGA:function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=s("rVsN"),o=s.n(e),a=(s("4qDb"),s("iRBI")),n=(s("CGmH"),s("OmjM")),c=(s("U/pO"),s("/pvS")),r=(s("y8TG"),s("Xm+1")),d=(s("7ZMB"),s("k/cs")),u=s("yqxf"),l=s("KS8L"),m=(d.a,r.a,c.a,n.a,{name:"SubmitDamage",data:function(){return{btnLoading:!1,dataList:[],bitian:s("jmUF"),taxWaybillId:this.$route.query.taxWaybillId||"",isFromH5:this.$route.query.isFromH5||"0",lossScenePhoto:[],lossEvidencePhoto:[],carPhoto:[],orgConfirmLossTime:"",orgLossFee:0}},components:{vanNavBar:d.a,vanButton:r.a,vanField:c.a,ImagePreview:n.a},computed:{isEdit:function(){return""==this.orgConfirmLossTime}},mounted:function(){this.$store.commit("updateLoadingStatus",{isLoading:!1}),this._getLossEnsureId()},methods:{onClickLeft:function(){this.$router.back()},goSuccess:function(){this.$router.push({path:"/SubmitDamageSuccess",query:{taxWaybillId:this.taxWaybillId,isFromH5:this.isFromH5}})},seeImg:function(t,i){Object(n.a)({images:t,startPosition:i,closeOnPopstate:!0,closeable:!0,onClose:function(){}})},validate:function(){return""==this.orgLossFee?(Object(a.a)("货损金额必填!"),!1):!(Number(this.orgLossFee)<=0)||(Object(a.a)("货损金额必须大于0!"),!1)},submitClick:function(){var t=this;this.btnLoading=!0,this.validate()?this._submitDamage().then(function(i){t.btnLoading=!1,t._submitDdMessage(i).then(function(i){t.updateApp(),t.goSuccess()})}).catch(function(){t.btnLoading=!1}):this.btnLoading=!1},_getLossEnsureId:function(){var t=this;return new o.a(function(i,s){t.$store.commit("updateLoadingStatus",{isLoading:!0}),Object(u.c)({taxWaybillId:t.taxWaybillId}).then(function(e){if(t.$store.commit("updateLoadingStatus",{isLoading:!1}),"0"===e.data.reCode){var o=e.data.result,a=o.lossScenePhoto,n=void 0===a?[]:a,c=o.lossEvidencePhoto,r=void 0===c?[]:c,d=o.carPhoto,u=void 0===d?[]:d,l=o.orgConfirmLossTime,m=void 0===l?"":l,g=o.orgLossFee,v=void 0===g?0:g,f=o.driverLossFee,h=void 0===f?0:f,L=o.ensurerLossFee,b=void 0===L?0:L;t.lossScenePhoto=n.split(",")||[],t.lossEvidencePhoto=r.split(",")||[],t.carPhoto=u.split(",")||[],t.orgConfirmLossTime=m,Number(b)>0?t.orgLossFee=b:Number(v)>0?t.orgLossFee=v:t.orgLossFee=h,window.document.title=t.isEdit?"确认货损":"查看货损",i()}else t.$vux.toast.text(e.data.reInfo,"middle"),s()}).catch(function(i){t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.$vux.toast.text(i.message,"middle"),s()})})},_submitDamage:function(){var t=this;return new o.a(function(i,s){t.$store.commit("updateLoadingStatus",{isLoading:!0}),Object(u.e)({taxWaybillId:t.taxWaybillId,orgLossFee:t.orgLossFee}).then(function(e){if(t.$store.commit("updateLoadingStatus",{isLoading:!1}),"0"===e.data.reCode){var o=e.data.result.msg;i(void 0===o?"":o)}else t.$vux.toast.text(e.data.reInfo,"middle"),s()}).catch(function(i){t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.$vux.toast.text(i.message,"middle"),s()})})},_submitDdMessage:function(t){var i=this;return new o.a(function(s,e){i.$store.commit("updateLoadingStatus",{isLoading:!0}),Object(u.f)({content:t}).then(function(t){i.$store.commit("updateLoadingStatus",{isLoading:!1}),"0"===t.data.reCode?s():(i.$vux.toast.text(t.data.reInfo,"middle"),e())}).catch(function(t){i.$store.commit("updateLoadingStatus",{isLoading:!1}),i.$vux.toast.text(t.message,"middle"),e()})})},updateApp:function(){var t={taxWaybillId:this.taxWaybillId,type:"3",content:{lookLossFlag:"0"}};try{Object(l.g)(t)}catch(t){console.log(t)}}}}),g={render:function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"SubmitDamage"},[s("c-header",{staticClass:"header"},[s("van-nav-bar",{attrs:{title:t.isEdit?"确认货损":"查看货损","left-arrow":""},on:{"click-left":t.onClickLeft}})],1),t._v(" "),s("div",{staticClass:"container"},[s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("1.货损现场照片")]),t._v(" "),s("div",{staticClass:"img_container"},t._l(t.lossScenePhoto,function(i,e){return s("div",{key:e,staticClass:"img_box",on:{click:function(i){return t.seeImg(t.lossScenePhoto,e)}}},[s("img",{attrs:{src:i,alt:"货损现场照片"}})])}),0)]),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("2.货损凭证照片")]),t._v(" "),s("div",{staticClass:"img_container"},t._l(t.lossEvidencePhoto,function(i,e){return s("div",{key:e,staticClass:"img_box",on:{click:function(i){return t.seeImg(t.lossEvidencePhoto,e)}}},[s("img",{attrs:{src:i,alt:"货损凭证照片"}})])}),0)]),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("\n        3.车身照片(需要包含前、后、45度角的照片至少各一张，车牌清晰可见）\n      ")]),t._v(" "),s("div",{staticClass:"img_container"},t._l(t.carPhoto,function(i,e){return s("div",{key:e,staticClass:"img_box",on:{click:function(i){return t.seeImg(t.carPhoto,e)}}},[s("img",{attrs:{src:i,alt:"车身照片"}})])}),0)]),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[s("img",{attrs:{src:t.bitian,alt:"",width:"8",height:"8"}}),t._v(" "),s("span",[t._v("4.货损金额")])]),t._v(" "),s("van-field",{attrs:{type:"number",disabled:!t.isEdit},scopedSlots:t._u([{key:"button",fn:function(){return[s("div",[t._v("元")])]},proxy:!0}]),model:{value:t.orgLossFee,callback:function(i){t.orgLossFee=i},expression:"orgLossFee"}})],1)]),t._v(" "),t.isEdit?s("div",{staticClass:"footer"},[s("van-button",{staticClass:"btn",attrs:{type:"primary",size:"large",loading:t.btnLoading},on:{click:function(i){return t.submitClick()}}},[t._v("确认货损")])],1):t._e()],1)},staticRenderFns:[]};var v=s("C7Lr")(m,g,!1,function(t){s("h4LK")},null,null);i.default=v.exports}});