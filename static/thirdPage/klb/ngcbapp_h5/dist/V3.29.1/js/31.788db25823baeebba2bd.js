webpackJsonp([31],{"0XzH":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("lC5x"),a=i.n(s),n=i("J0Oq"),o=i.n(n),l=i("rVsN"),r=i.n(l),c=i("KS8L"),u=i("P9l9"),d=i("xXJT"),m=(d.a,{name:"uploadAgreement",data:function(){return{pageType:Number(this.$route.query.pageType),payState:"0",taxWaybillId:this.$route.query.taxWaybillId,isH5:this.$route.query.isH5||!1,xid:this.$route.query.xid,imgList:[],file:[],buttonName:"上传",contractPhotoUrlList:[],disabled:!1}},components:{selectImage:d.a},beforeRouteEnter:function(t,e,i){i(function(t){document.title=1==t.$route.query.pageType?"上传纸质协议":"查看协议"})},computed:{},mounted:function(){this.initPageData(),2===this.pageType&&this._getBillImage(),this.$store.commit("updateLoadingStatus",{isLoading:!1})},methods:{initPageData:function(){switch(this.pageType){case 1:this.buttonName="上传";break;case 2:this.buttonName="确认修改";break;default:this.buttonName="上传"}},_getBillImage:function(){var t=this;this.$store.commit("updateLoadingStatus",{isLoading:!0});var e={imageType:3,xid:this.xid};Object(u.o)(e).then(function(e){(t.$store.commit("updateLoadingStatus",{isLoading:!1}),"0"===e.data.reCode)?e.data.result.htz.forEach(function(e){t.imgList.push({name:"",src:e.origPath}),t.file.push(null)}):t.$vux.toast.text("网络异常，请稍后再试~~~","middle")})},_uploadImgUrl:function(){var t=this,e={taxWaybillId:this.taxWaybillId,xid:this.xid,contractPhotoUrl:this.contractPhotoUrlList.toString()};return new r.a(function(i,s){Object(u.N)(e).then(function(e){"0"!==e.data.reCode?(t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.disabled=!1,t.$vux.toast.text(e.data.reInfo,"middle"),s()):i(e)})})},clickConfirm:function(){this.disabled=!0,this.$store.commit("updateLoadingStatus",{isLoading:!0}),this._clickConfirm()},_clickConfirm:function(){var t=this;return o()(a.a.mark(function e(){var i,s,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!0,s=[],0===t.file.filter(Boolean).length){e.next=23;break}return e.prev=3,e.next=6,Object(u.M)(t.file.filter(Boolean));case 6:if("0"===(n=e.sent).data.reCode){e.next=15;break}return t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.disabled=!1,t.$vux.toast.text(n.data.reInfo,"middle"),i=!1,e.abrupt("return");case 15:s=n.data.result.urlList;case 16:e.next=23;break;case 18:e.prev=18,e.t0=e.catch(3),t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.disabled=!1,t.$vux.toast.text("网络异常，请稍后再试~~~","middle");case 23:if(t.contractPhotoUrlList=t.imgList.map(function(e,i,a){return t.file[i]?s.shift():e.src}),i){e.next=26;break}return e.abrupt("return");case 26:if(e.prev=26,0!==t.contractPhotoUrlList.length){e.next=32;break}return t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.disabled=!1,t.$vux.toast.text("图片不能为空！","middle"),e.abrupt("return");case 32:return e.next=34,t._uploadImgUrl();case 34:e.next=40;break;case 36:e.prev=36,e.t1=e.catch(26),t.$store.commit("updateLoadingStatus",{isLoading:!1}),t.disabled=!1;case 40:1===t.pageType?(t.$vux.toast.text("上传成功","middle"),Object(c.f)({type:"1",taxWaybillId:t.taxWaybillId})):t.$vux.toast.text("修改成功","middle"),t.isH5?t.$router.back(-1):setTimeout(function(){Object(c.a)(-1)},1e3);case 42:case"end":return e.stop()}},e,t,[[3,18],[26,36]])}))()}}}),g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upload-agreement-container"},[i("c-header",[i("x-header",{attrs:{"left-options":{backText:""}}},[t._v("上传协议")])],1),t._v(" "),i("div",{staticClass:"title"},[t._v("请上传和司机签署的纸质电子协议")]),t._v(" "),i("div",{staticClass:"select"},[i("selectImage",{attrs:{multiple:!0,file:t.file,imgList:t.imgList,imgListMaxLength:2}})],1),t._v(" "),i("div",{staticClass:"button"},[i("x-button",{attrs:{type:"primary",disabled:t.disabled},nativeOn:{click:function(e){return t.clickConfirm(e)}}},[t._v(t._s(t.buttonName))])],1)],1)},staticRenderFns:[]};var f=i("C7Lr")(m,g,!1,function(t){i("sAvV")},null,null);e.default=f.exports},"1ycf":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAACj0lEQVR4Xu2c3U0bQQAG97oI6ShpIxI9nAvwVpE2SEWJ6cKREUgIGR6+H7iD4RV9c3szxuJpl7Hzn8Ph8ON8Pv8eY9w8vsppWZZfx+Pxzx5fbdnjoZ+feV3Xf89iPP3qNOf8vsd3+wxBztfEzzl3+W67PPSLvxCCbOmrYF1XghCkZ4CvrJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW29EkJ5biUwQSVtvRJCeW4lMEElbb0SQnluJTBBJW2+0XLlvqvc0yG8ZeLjna3nlvinUfYyB0yXI1dt0PuY8PJUgG/sM8JW1rSD3lyA/xxiXSyS/betsX+40f8cYt/zbu7HuBCFI1gB3LmZ92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrMAgmR92jSC2AqzAIJkfdo0gtgKswCCZH3aNILYCrOAVy5gu59z3mSf9D60z3DXycvbjB5u1Zlz3r2PwuxT/gORlpdXrH4fowAAAABJRU5ErkJggg=="},q47J:function(t,e){},sAvV:function(t,e){},xXJT:function(t,e,i){"use strict";var s=i("aA9S"),a=i.n(s),n=i("JjWs"),o=i.n(n),l=(Boolean,Number,Array,Boolean,Array,Number,String,Boolean,{name:"selectImage",data:function(){return{selectIndex:0,options:{getThumbBoundsFn:function(t){var e=document.querySelectorAll(".show-img")[t],i=window.pageYOffset||document.documentElement.scrollTop,s=e.getBoundingClientRect();return{x:s.left,y:s.top+i,w:s.width}},isClickableElement:function(t){return/previewer-download-icon/.test(t.className)},history:!0,timeToIdle:!1,tapToToggleControls:!1,fullscreenEl:!1,zoomEl:!1,shareEl:!1,counterEl:!0,arrowEl:!1,preloaderEl:!1,captionEl:!1}}},computed:{list:function(){var t=[];return this.imgList.forEach(function(e){e&&t.push({src:e.src})}),t}},props:{multiple:{type:Boolean,default:!1},count:{type:Number,default:1},file:{type:Array,default:[]},reUpload:{type:Boolean,default:!1},imgList:{type:Array,default:[]},imgListMaxLength:{type:Number,default:2},borderStyle:{type:String,default:""},isNoChangeAmount:{type:Boolean,default:!1}},mounted:function(){},methods:{downloadImg:function(){},logIndexChange:function(t){},onPreviewClose:function(){this.$refs.previewer.photoswipe=null},show:function(t){this.$refs.previewer.show(t)},fileClick:function(t){this.selectIndex=t,this.$refs.file.dispatchEvent(new MouseEvent("click"))},handleFilesUpload:function(t){this.$store.commit("updateLoadingStatus",{isLoading:!0});var e=this,i=t.target.files[0];o()(i,{quality:.5,fieldName:"file"}).then(function(t){e.$store.commit("updateLoadingStatus",{isLoading:!1}),e.$set(e.file,e.selectIndex,t.base64);var s={};s.src=t.base64,s.name=i.name,e.$set(e.imgList,e.selectIndex,s),e.$refs.file.value=""}).catch(function(t){e.$store.commit("updateLoadingStatus",{isLoading:!1}),console.log(t)})},fileAdd:function(t){var e=new FileReader;e._this=this,e.readAsDataURL(t),e.onload=function(){var i=a()({},t);i.src=this.result,e._this.multiple?e._this.imgList.push(i):e._this.$set(e._this.imgList,e._this.selectIndex,i)},this.$refs.file.value=""},fileDel:function(t){this.size=this.size-this.imgList[t].size,this.multiple?(this.imgList.splice(t,1),this.file.splice(t,1)):(this.$set(this.imgList,t,null),this.$set(this.file,t,null))}}}),r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"select-image-container"},[t.multiple?s("div",[s("div",{staticClass:"multiple-content"},[t._l(t.imgList,function(e,a){return s("div",{directives:[{name:"show",rawName:"v-show",value:0!=t.imgList.length,expression:"imgList.length != 0"}],key:a,staticClass:"multiple-show-content"},[s("div",{staticClass:"show-box multiple-show-box"},[s("div",{staticClass:"show-img-box multiple-show-img-box",on:{click:function(e){return t.show(a)}}},[s("div",{staticClass:"upload_warp_img_div_top"},[s("div",{staticClass:"upload_warp_img_div_text"},[t._v(t._s(e.name))]),t._v(" "),t.isNoChangeAmount?t._e():s("img",{directives:[{name:"show",rawName:"v-show",value:t.imgList.length>1,expression:"imgList.length>1"}],staticClass:"upload_warp_img_div_del",attrs:{src:i("6E7O")},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.fileDel(a)}}})]),t._v(" "),s("img",{staticClass:"show-img",attrs:{src:e.src}})])]),t._v(" "),t.reUpload?s("div",{staticClass:"select-bottom-box"},[s("div",{staticClass:"select-bottom"},[s("div",{on:{click:function(e){return t.fileClick(a)}}},[t._v("重新上传")])])]):t._e()])}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isNoChangeAmount&&t.imgList.length<t.imgListMaxLength,expression:"!isNoChangeAmount&&imgList.length < imgListMaxLength"}],staticClass:"select-box",style:"dashed"==t.borderStyle?"border: 1px dashed #999;":"",on:{click:function(e){return t.fileClick(t.imgList.length)}}},[t._m(0)])],2)]):t._e(),t._v(" "),t.multiple?t._e():s("div",[t._t("select-title"),t._v(" "),s("div",{staticClass:"content"},t._l(t.count,function(e){return s("div",{key:e},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.imgList[e-1],expression:"!imgList[index - 1]"}],staticClass:"select-box",on:{click:function(i){return t.fileClick(e-1)}}},[s("div",{staticClass:"select-img-box"},[s("img",{staticClass:"select-img",attrs:{src:i("1ycf")}}),t._v(" "),t._t("select-text"),t._v(" "),t._t("select-text"+e)],2)]),t._v(" "),t.imgList[e-1]?s("div",{staticClass:"show-box"},[s("div",{staticClass:"show-img-box",on:{click:function(i){return t.show(e-1)}}},[s("img",{staticClass:"show-img",attrs:{src:t.imgList[e-1].src}})])]):t._e()])}),0),t._v(" "),t.reUpload?s("div",{staticClass:"select-bottom-box"},t._l(t.count,function(e){return s("div",{key:e,staticStyle:{width:"50%"}},[s("div",{staticClass:"select-bottom"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!!t.imgList[e-1],expression:"!!imgList[index - 1]"}],on:{click:function(i){return t.fileClick(e-1)}}},[t._v("重新上传")])])])}),0):t._e()],2),t._v(" "),s("input",{ref:"file",staticClass:"file",attrs:{type:"file",id:"files",name:"imageFile",accept:"image/*"},on:{change:function(e){return t.handleFilesUpload(e)}}}),t._v(" "),s("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[s("previewer",{ref:"previewer",attrs:{list:t.list,options:t.options},on:{"on-index-change":t.logIndexChange,"on-close":t.onPreviewClose}})],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"select-img-box"},[e("img",{staticClass:"select-img",attrs:{src:i("1ycf")}})])}]};var c=i("C7Lr")(l,r,!1,function(t){i("q47J")},null,null);e.a=c.exports}});