(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5381c266"],{"27bc":function(n,o,t){"use strict";var i=t("5349"),e=t.n(i);e.a},5349:function(n,o,t){},"61fd":function(n,o,t){"use strict";t.r(o);var i=function(){var n=this,o=n.$createElement,t=n._self._c||o;return t("div",{staticClass:"upload_pound_bill_multiple_box"},[t("v-header",{attrs:{title:n.titleText}}),t("example-picture",{attrs:{tip3:!0}}),t("div",{staticClass:"upload_wrapper",class:{upload_item_no:!n.poundUrlArr.length}},[t("single-upload",{attrs:{urlArr:n.poundUrlArr,type:"3",canModifyPhoto:n.resultInfo.canModifyPhoto,maxLen:n.imgTotalCount},on:{change:n.handleUpload,remove:n.removeImg}})],1),t("van-cell-group",{staticClass:"input_group mt5"},[t("van-field",{attrs:{label:"装货数量",placeholder:"请输入装货数量","input-align":"right",type:"number",readonly:""},on:{click:function(o){return n.showConfirm("0")}},scopedSlots:n._u([{key:"button",fn:function(){return[t("p",{staticClass:"input_right"},[n._v(n._s(n.resultInfo.goodsAmountType))])]},proxy:!0}]),model:{value:n.loadingTonnage,callback:function(o){n.loadingTonnage=o},expression:"loadingTonnage"}}),t("van-field",{attrs:{label:"卸货数量",placeholder:"请输入卸货数量","input-align":"right",type:"number",readonly:""},on:{click:function(o){return n.showConfirm("1")}},scopedSlots:n._u([{key:"button",fn:function(){return[t("p",{staticClass:"input_right"},[n._v(n._s(n.resultInfo.goodsAmountType))])]},proxy:!0}]),model:{value:n.unloadingTonnage,callback:function(o){n.unloadingTonnage=o},expression:"unloadingTonnage"}})],1),"1"===n.resultInfo.hybState?t("p",{staticClass:"notice"},[n._v("为保证运费全部结算，请上传今日所有运输磅单！")]):n._e(),t("div",{staticClass:"btn_container"},["1"===n.resultInfo.canModifyPhoto?t("div",{staticClass:"pub_fixed_btn"},[t("van-button",{staticClass:"item",attrs:{type:n.poundUrlArr.length?"primary":"danger"},on:{click:n.resetSubmit}},[n._v("确认提交")])],1):n._e()]),t("modify-amount-popup",{attrs:{modifyAmountPopop:n.modifyAmountPopop,confirmObj:n.modifyAmountInfo},on:{change:n.onPopupConfirm}})],1)},e=[],a=t("22b6"),l=t("77ea"),s=t("2f14"),r=t("a711"),u=t("4e2c"),d=t("1745"),c={components:{ExamplePicture:r["a"],ModifyAmountPopup:u["a"],SingleUpload:d["a"]},props:{},name:"upload_pound_bill_multiple",data:function(){return{fromType:this.$route.query.from_type||"",taxWaybillId:this.$route.query.tax_waybill_id,titleText:"上传磅单",imgTotalCount:20,modifyAmountPopop:!1,modifyAmountInfo:{modifyType:"",modifyAmountType:"",modifyAmountNum:""},poundUrlArr:[],loadingTonnage:"",unloadingTonnage:"",resultInfo:{},btnSending:!1,locationInfo:{},locationFailInfo:{}}},watch:{},computed:{},methods:{showConfirm:function(n){this.resultInfo&&"1"===this.resultInfo.canModifyPhoto&&(this.modifyAmountInfo={modifyType:n,modifyAmountType:this.resultInfo.goodsAmountType||"",modifyAmountNum:"0"===n?this.loadingTonnage:this.unloadingTonnage},this.modifyAmountPopop=!0)},onPopupConfirm:function(n){this.modifyAmountPopop=!1,n.cancelBtn||("0"===this.modifyAmountInfo.modifyType?this.loadingTonnage=n.value:this.unloadingTonnage=n.value)},removeImg:function(n,o){this.poundUrlArr.splice(o,1)},handleUpload:function(){"0"!==this.resultInfo.canModifyPhoto&&Object(l["i"])({cameraType:"7",num:this.imgTotalCount-this.poundUrlArr.length,fileType:"1",triggerType:"2",buriedPointType:"34",logExplain:"大宗多趟不区分上传磅单"})},receviveImgJson:function(n){if(n){var o=JSON.parse(n),t=o.imgData;this.poundUrlArr=this.poundUrlArr.concat(t)}},locationFail:function(n){n&&(this.locationFailInfo=JSON.parse(decodeURI(n)))},backAppNewLocation:function(n){n&&"{}"!==n&&(this.locationInfo=JSON.parse(decodeURI(n)))},resetSubmit:function(){var n=this;if(0!==this.poundUrlArr.length)if("2"===this.resultInfo.hybState&&this.poundUrlArr.length<2)this.$toast("请至少上传两张磅单");else if(!this.btnSending&&this.resultInfo.canFinishOrder){var o={reInfo:"H5没收到客户端定位信息",locationTime:(new Date).getTime()};"{}"!==JSON.stringify(this.locationInfo)?o=this.locationInfo:"{}"!==JSON.stringify(this.locationFailInfo)&&(o=this.locationFailInfo);var t="1";this.resultInfo.loadingTonnage===this.loadingTonnage&&this.resultInfo.unloadingTonnage===this.unloadingTonnage&&(t="0"),this.$toast.loading({message:"正在提交"}),this.btnSending=!0,Object(a["a"])({sid:"925032",data:{taxWaybillId:this.taxWaybillId,receiptUrls:this.poundUrlArr,loadingTonnage:this.loadingTonnage,unloadingTonnage:this.unloadingTonnage,canModTonnage:t,isModifyPhoto:this.poundUrlArr.join(",")===this.resultInfo.hd.join(",")?"0":"1",canFinishOrder:this.resultInfo.canFinishOrder,locationInfo:o},encrypt:"0"}).then((function(o){"0"===o.data.reCode?("1"===o.data.result.isFreshClient&&Object(l["r"])(),Object(s["h"])("/pound_success?tax_waybill_id=".concat(n.taxWaybillId,"&from_diff=0&from_type=").concat(n.fromType),n),setTimeout((function(){n.btnSending=!1}),200)):n.btnSending=!1})).catch((function(){n.btnSending=!1}))}},init:function(){var n=this;this.$toast.loading({message:"加载中"}),Object(a["a"])({sid:"925031",data:{loadType:"0",taxWaybillId:this.taxWaybillId},encrypt:"0"}).then((function(o){if("0"===o.data.reCode){var t=o.data.result;n.resultInfo=t,"1"===t.pageTitleType?n.titleText="上传磅单":n.titleText="查看磅单",n.poundUrlArr=t.hd,n.loadingTonnage=t.loadingTonnage,n.unloadingTonnage=t.unloadingTonnage,"1"===n.resultInfo.canModifyPhoto&&Object(l["h"])({tip:"您的定位服务未开启，请前往开启"})}else n.resultInfo={}}))}},created:function(){this.init(),window.AppJSApi_BackAppPhotoJson=this.receviveImgJson,window.AppJSApi_BackAppNewLocation=this.backAppNewLocation,window.AppJSApi_BackLocationFailed=this.locationFail,window.AppJSApi_InitSendFlag=this.locationFail},mounted:function(){}},p=c,f=(t("27bc"),t("2877")),h=Object(f["a"])(p,i,e,!1,null,"4598a12f",null);o["default"]=h.exports}}]);