(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40e83b69"],{1493:function(n,o,t){"use strict";var i=t("c578"),e=t.n(i);e.a},3846:function(n,o,t){t("9e1e")&&"g"!=/./g.flags&&t("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:t("0bfb")})},"3ac1":function(n,o){n.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWBAMAAAAyb6E1AAAAFVBMVEVHcEzkMi7kMi7kMi7kMi7kMi7kMi4sv0DuAAAABnRSTlMAlKKHAgPiB2nyAAAAWElEQVQI12MwS0tLSwpgAAFmIDNNBcxkAAs7gJmMIGEFiLAYkJnIgBAWQBdmYUIIs6gBmckQFU4gYQMwkxUhjMREKEDShjCMBWEFksVoggoOqE5H8hDCmwC6+CfdX6Ia5QAAAABJRU5ErkJggg=="},"6b54":function(n,o,t){"use strict";t("3846");var i=t("cb7c"),e=t("0bfb"),a=t("9e1e"),s="toString",l=/./[s],c=function(n){t("2aba")(RegExp.prototype,s,n,!0)};t("79e5")((function(){return"/a/b"!=l.call({source:"a",flags:"b"})}))?c((function(){var n=i(this);return"/".concat(n.source,"/","flags"in n?n.flags:!a&&n instanceof RegExp?e.call(n):void 0)})):l.name!=s&&c((function(){return l.call(this)}))},"6bf4":function(n,o,t){"use strict";t.r(o);var i=function(){var n=this,o=n.$createElement,t=n._self._c||o;return t("div",{directives:[{name:"show",rawName:"v-show",value:!n.isLoading,expression:"!isLoading"}],staticClass:"upload_pound_bill_box",class:{pab46:!n.activeType}},[t("v-header",{attrs:{title:n.titleText,backFn:n.backHandle}}),t("div",{staticClass:"warpper"},[n.activeType?t("single-header",{attrs:{activeType:n.activeType}}):n._e(),t("example-picture"),t("div",{staticClass:"upload_wrapper"},[t("single-upload",{directives:[{name:"show",rawName:"v-show",value:"0"===n.activeType||!n.activeType,expression:"activeType === '0' || !activeType"}],attrs:{urlArr:n.loadingInfo.tonnageUrl,type:"0",canModifyPhoto:n.resultInfo.canModifyPhoto,maxLen:1},on:{change:n.handleUpload,remove:n.removeImg}}),t("single-upload",{directives:[{name:"show",rawName:"v-show",value:"1"===n.activeType||!n.activeType,expression:"activeType === '1' || !activeType"}],attrs:{urlArr:n.unLoadingInfo.tonnageUrl,type:"1",canModifyPhoto:n.resultInfo.canModifyPhoto,maxLen:1},on:{change:n.handleUpload,remove:n.removeImg}})],1),t("van-cell-group",{staticClass:"input_group mt5"},[t("van-field",{directives:[{name:"show",rawName:"v-show",value:"0"===n.activeType||!n.activeType,expression:"activeType === '0' || !activeType"}],attrs:{label:"装货数量",placeholder:"请输入装货数量","input-align":"right",type:"number",readonly:""},on:{click:function(o){return n.showConfirm("0")}},scopedSlots:n._u([{key:"button",fn:function(){return[t("p",{staticClass:"input_right"},[n._v(n._s(n.resultInfo.goodsAmountType))])]},proxy:!0}]),model:{value:n.loadingInfo.tonnage,callback:function(o){n.$set(n.loadingInfo,"tonnage",o)},expression:"loadingInfo.tonnage"}}),t("van-field",{directives:[{name:"show",rawName:"v-show",value:"1"===n.activeType||!n.activeType,expression:"activeType === '1' || !activeType"}],attrs:{label:"卸货数量",placeholder:"请输入卸货数量","input-align":"right",type:"number",readonly:""},on:{click:function(o){return n.showConfirm("1")}},scopedSlots:n._u([{key:"button",fn:function(){return[t("p",{staticClass:"input_right"},[n._v(n._s(n.resultInfo.goodsAmountType))])]},proxy:!0}]),model:{value:n.unLoadingInfo.tonnage,callback:function(o){n.$set(n.unLoadingInfo,"tonnage",o)},expression:"unLoadingInfo.tonnage"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"1"===n.activeType,expression:"activeType === '1'"}],staticClass:"upload_notice"},[t("van-icon",{attrs:{name:"warning",size:"14"}}),t("p",{staticClass:"notice_text"},[n._v("若您还未卸货，请点击下方“未卸货，暂不上传”按钮。")])],1)],1),t("div",{staticClass:"btn_container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"0"===n.activeType,expression:"activeType === '0'"}]},[n.noticeShow?t("p",{staticClass:"send_notice"},[n._v("已上传装货磅单，点击下方按钮上传卸货磅单")]):n._e(),t("div",{staticClass:"send_btn"},[t("van-button",{attrs:{round:"",type:"primary"},on:{click:n.sendLoading}},[n._v("确认提交，下一步")])],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:"1"===n.activeType,expression:"activeType === '1'"}],staticClass:"send_btn_group"},[t("p",{staticClass:"send_btn"},[t("van-button",{attrs:{round:"",type:"primary"},on:{click:n.noSendUnLoading}},[n._v("未卸货，暂不上传")])],1),t("p",{staticClass:"send_btn"},[t("van-button",{attrs:{round:"",type:"primary"},on:{click:n.sendUnloading}},[n._v("确认提交")])],1)]),!n.activeType&&n.resultInfo&&"1"===n.resultInfo.canModifyPhoto?t("div",{staticClass:"pub_fixed_btn"},[t("van-button",{staticClass:"item",attrs:{type:"primary"},on:{click:n.resetSubmit}},[n._v("重新提交")])],1):n._e()]),t("modify-amount-popup",{attrs:{modifyAmountPopop:n.modifyAmountPopop,confirmObj:n.modifyAmountInfo},on:{change:n.onPopupConfirm}})],1)},e=[],a=(t("6b54"),t("22b6")),s=t("77ea"),l=t("2f14"),c=function(){var n=this,o=n.$createElement,i=n._self._c||o;return i("div",{staticClass:"single_header_box"},[i("div",{staticClass:"pound_title"},[i("p",{staticClass:"pound_text",class:{active:"0"===n.activeType}},[n._v("1.上传装货磅单")]),i("img",{staticClass:"arrow",attrs:{src:t("3ac1")}}),i("p",{staticClass:"pound_text",class:{active:"1"===n.activeType}},[n._v("2.上传卸货磅单")])])])},r=[],d={components:{},props:{activeType:{type:String,default:"0"}},name:"single_header",data:function(){return{}},watch:{},computed:{},methods:{},created:function(){},mounted:function(){}},g=d,u=(t("829e"),t("2877")),p=Object(u["a"])(g,c,r,!1,null,"1cfeec84",null),f=p.exports,h=t("a711"),y=t("4e2c"),v=t("1745"),m={components:{SingleHeader:f,ExamplePicture:h["a"],ModifyAmountPopup:y["a"],SingleUpload:v["a"]},name:"upload_pound_bill",data:function(){return{isLoading:!0,titleText:"",activeType:"",uploadType:"",fromType:this.$route.query.from_type||"",taxWaybillId:this.$route.query.tax_waybill_id,modifyAmountPopop:!1,modifyAmountInfo:{modifyType:"",modifyAmountType:"",modifyAmountNum:""},noticeShow:!1,loadingInfo:{tonnage:"",tonnageUrl:[],originalTonnage:"",originalTonnageUrl:""},unLoadingInfo:{tonnage:"",tonnageUrl:[],originalTonnage:"",originalTonnageUrl:""},resultInfo:{},btnSending:!1,locationInfo:{},locationFailInfo:{}}},methods:{backHandle:function(){if("1"===this.activeType&&!this.$route.query.active_type)return this.init(),void(this.activeType="0");this.$router.back()},showConfirm:function(n){this.resultInfo&&"1"===this.resultInfo.canModifyPhoto&&(this.modifyAmountInfo={modifyType:n,modifyAmountType:this.resultInfo.goodsAmountType||"",modifyAmountNum:"0"===n?this.loadingInfo.tonnage:this.unLoadingInfo.tonnage},this.modifyAmountPopop=!0)},onPopupConfirm:function(n){this.modifyAmountPopop=!1,n.cancelBtn||("0"===this.modifyAmountInfo.modifyType?this.loadingInfo=Object.assign(this.loadingInfo,{tonnage:n.value}):this.unLoadingInfo=Object.assign(this.unLoadingInfo,{tonnage:n.value}))},removeImg:function(n,o){"0"!==n?"1"===n&&this.unLoadingInfo.tonnageUrl.splice(o,1):this.loadingInfo.tonnageUrl.splice(o,1)},handleUpload:function(n){"0"!==this.resultInfo.canModifyPhoto&&(this.uploadType=n,Object(s["i"])({cameraType:"7",num:1,fileType:"1",triggerType:"2",buriedPointType:"35",logExplain:"大宗普通运单上传磅单"}))},receviveImgJson:function(n){if(n){var o=JSON.parse(n),t=o.imgData;"0"!==this.uploadType?"1"===this.uploadType&&(this.unLoadingInfo=Object.assign(this.unLoadingInfo,{tonnageUrl:this.unLoadingInfo.tonnageUrl.concat(t)})):this.loadingInfo=Object.assign(this.loadingInfo,{tonnageUrl:this.loadingInfo.tonnageUrl.concat(t)})}},locationFail:function(n){n&&(this.locationFailInfo=JSON.parse(decodeURI(n)))},backAppNewLocation:function(n){n&&"{}"!==n&&(this.locationInfo=JSON.parse(decodeURI(n)))},sendLoading:function(){this.loadingInfo.tonnageUrl.length?this.sureAction(0):this.$toast("请上传装货磅单")},noSendUnLoading:function(){Object(l["h"])("/pound_success?tax_waybill_id=".concat(this.taxWaybillId,"&complete=0&from_type=").concat(this.fromType),this)},sendUnloading:function(){this.unLoadingInfo.tonnageUrl.length?this.sureAction(1):this.$toast("请上传卸货磅单")},resetSubmit:function(){this.loadingInfo.tonnageUrl.length?this.unLoadingInfo.tonnageUrl.length?this.sureAction(3):this.$toast("请上传卸货磅单"):this.$toast("请上传装货磅单")},sureAction:function(n){var o=this;if(!this.btnSending&&this.resultInfo.canFinishOrder){var t={reInfo:"H5没收到客户端定位信息",locationTime:(new Date).getTime()};"{}"!==JSON.stringify(this.locationInfo)?t=this.locationInfo:"{}"!==JSON.stringify(this.locationFailInfo)&&(t=this.locationFailInfo),this.$toast.loading({message:"正在提交"}),this.btnSending=!0,Object(a["a"])({sid:"925030",data:{taxWaybillId:this.taxWaybillId,loadingTonnageUrl:this.loadingInfo.tonnageUrl[0]||"",canModLoadUrl:this.loadingInfo.tonnageUrl.toString()===this.loadingInfo.originalTonnageUrl?"0":"1",loadingTonnage:this.loadingInfo.tonnage,canModLoadTonnage:this.loadingInfo.tonnage===this.loadingInfo.originalTonnage?"0":"1",unloadingTonnageUrl:this.unLoadingInfo.tonnageUrl[0]||"",canModUnloadUrl:this.unLoadingInfo.tonnageUrl.toString()===this.unLoadingInfo.originalTonnageUrl?"0":"1",unloadingTonnage:this.unLoadingInfo.tonnage,canModUnloadTonnage:this.unLoadingInfo.tonnage===this.unLoadingInfo.originalTonnage?"0":"1",canFinishOrder:this.resultInfo.canFinishOrder,locationInfo:t},encrypt:"0"}).then((function(t){if("0"===t.data.reCode){if(o.$toast("上传成功"),0===n)return o.activeType="1",void(o.btnSending=!1);"1"===t.data.result.isFreshClient&&Object(s["r"])(),Object(l["h"])("/pound_success?tax_waybill_id=".concat(o.taxWaybillId,"&complete=1&from_type=").concat(o.fromType),o),setTimeout((function(){o.btnSending=!1}),200)}else o.btnSending=!1})).catch((function(){o.btnSending=!1}))}},init:function(n){var o=this;this.$toast.loading({message:"加载中"}),Object(a["a"])({sid:"925029",data:{taxWaybillId:this.taxWaybillId},encrypt:"0"}).then((function(t){if(o.isLoading=!1,"0"===t.data.reCode){var i=t.data.result;o.resultInfo=i,i.loadingTonnageUrl&&i.unloadingTonnageUrl?(o.titleText="查看磅单",o.activeType=""):(o.titleText="上传磅单",o.activeType=o.$route.query.active_type||"0"),"1"===n&&(o.activeType="1"),i.loadingTonnageUrl&&(o.noticeShow=!0),o.loadingInfo={tonnage:i.loadingTonnage,tonnageUrl:i.loadingTonnageUrl?[i.loadingTonnageUrl]:[],originalTonnage:i.loadingTonnage,originalTonnageUrl:i.loadingTonnageUrl},o.unLoadingInfo={tonnage:i.unloadingTonnage,tonnageUrl:i.unloadingTonnageUrl?[i.unloadingTonnageUrl]:[],originalTonnage:i.unloadingTonnage,originalTonnageUrl:i.unloadingTonnageUrl},"1"===o.resultInfo.canModifyPhoto&&Object(s["h"])({tip:"您的定位服务未开启，请前往开启"})}else o.resultInfo={}}))}},created:function(){this.init(),window.AppJSApi_BackAppPhotoJson=this.receviveImgJson,window.AppJSApi_BackAppNewLocation=this.backAppNewLocation,window.AppJSApi_BackLocationFailed=this.locationFail,window.AppJSApi_InitSendFlag=this.locationFail},mounted:function(){}},T=m,I=(t("1493"),Object(u["a"])(T,i,e,!1,null,"73742bc2",null));o["default"]=I.exports},"829e":function(n,o,t){"use strict";var i=t("d563"),e=t.n(i);e.a},c578:function(n,o,t){},d563:function(n,o,t){}}]);